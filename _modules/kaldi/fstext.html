

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>kaldi.fstext &mdash; PyKaldi 0.0.9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/pykaldi-theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="PyKaldi 0.0.9 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/pykaldi-logo-light.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/install.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/conv.html">Coding Conventions</a></li>
</ul>
<p class="caption"><span class="caption-text">API Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.base.html">kaldi.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.chain.html">kaldi.chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.cudamatrix.html">kaldi.cudamatrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.decoder.html">kaldi.decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.feat.html">kaldi.feat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.fstext.html">kaldi.fstext</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.gmm.html">kaldi.gmm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.hmm.html">kaldi.hmm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.itf.html">kaldi.itf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.ivector.html">kaldi.ivector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.kws.html">kaldi.kws</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.lat.html">kaldi.lat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.lm.html">kaldi.lm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.matrix.html">kaldi.matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.nnet3.html">kaldi.nnet3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.online2.html">kaldi.online2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.rnnlm.html">kaldi.rnnlm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.sgmm2.html">kaldi.sgmm2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.tfrnnlm.html">kaldi.tfrnnlm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.transform.html">kaldi.transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.tree.html">kaldi.tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kaldi.util.html">kaldi.util</a></li>
</ul>

            
          
    <p class="caption"><span class="caption-text">Other</span></p>
    <ul>
    <li class="toctree-l1"><a href="../../genindex.html">Index</a></li>
    </ul>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyKaldi</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>kaldi.fstext</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for kaldi.fstext</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PyKaldi has built-in support for common FST types (including Kaldi lattices and</span>
<span class="sd">KWS index) and operations. The API for the user facing PyKaldi FST types and</span>
<span class="sd">operations is mostly defined in Python mimicking the API exposed by OpenFst&#39;s</span>
<span class="sd">official Python wrapper `pywrapfst</span>
<span class="sd">&lt;http://www.openfst.org/twiki/bin/view/FST/PythonExtension&gt;`_ to a large extent.</span>
<span class="sd">This includes integrations with Graphviz and IPython for interactive</span>
<span class="sd">visualization of FSTs.</span>

<span class="sd">There are two major differences between the PyKaldi FST package and pywrapfst:</span>

<span class="sd">#. PyKaldi bindings are generated with CLIF while pywrapfst bindings are</span>
<span class="sd">   generated with Cython. This allows PyKaldi FST types to work seamlessly with</span>
<span class="sd">   the rest of the PyKaldi package.</span>

<span class="sd">#. In contrast to pywrapfst, PyKaldi does not wrap OpenFst scripting API, which</span>
<span class="sd">   uses virtual dispatch, function registration, and dynamic loading of shared</span>
<span class="sd">   objects to provide a common interface shared by FSTs of different semirings.</span>
<span class="sd">   While this change requires wrapping each semiring specialization separately</span>
<span class="sd">   in PyKaldi, it gives users the ability to pass FST objects directly to the</span>
<span class="sd">   myriad PyKaldi functions accepting FST arguments.</span>

<span class="sd">Operations which construct new FSTs are implemented as traditional functions, as</span>
<span class="sd">are two-argument boolean functions like `equal` and `equivalent`. Convert</span>
<span class="sd">operation is not implemented as a separate function since FSTs already support</span>
<span class="sd">construction from other FST types, e.g. vector FSTs can be constructed from</span>
<span class="sd">constant FSTs and vice versa. Destructive operations---those that mutate an FST,</span>
<span class="sd">in place---are instance methods, as is `write`.</span>

<span class="sd">The following example, based on `Mohri et al. 2002`_, shows the construction of</span>
<span class="sd">an ASR graph given a pronunciation lexicon L, grammar G, a transducer from</span>
<span class="sd">context-dependent phones to context-independent phones C, and an HMM set H::</span>

<span class="sd">    import kaldi.fstext as fst</span>

<span class="sd">    L = fst.StdVectorFst.read(&quot;L.fst&quot;)</span>
<span class="sd">    G = fst.StdVectorFst.read(&quot;G.fst&quot;)</span>
<span class="sd">    C = fst.StdVectorFst.read(&quot;C.fst&quot;)</span>
<span class="sd">    H = fst.StdVectorFst.read(&quot;H.fst&quot;)</span>
<span class="sd">    LG = fst.determinize(fst.compose(L, G))</span>
<span class="sd">    CLG = fst.determinize(fst.compose(C, LG))</span>
<span class="sd">    HCLG = fst.determinize(fst.compose(H, CLG))</span>
<span class="sd">    HCLG.minimize()                                      # NB: works in-place.</span>

<span class="sd">.. _`Mohri et al. 2002`:</span>
<span class="sd">   http://www.openfst.org/twiki/pub/FST/FstBackground/csl01.pdf</span>
<span class="sd">.. autoconstant:: NO_STATE_ID</span>
<span class="sd">.. autoconstant:: NO_LABEL</span>
<span class="sd">.. autoconstant:: ENCODE_FLAGS</span>
<span class="sd">.. autoconstant:: ENCODE_LABELS</span>
<span class="sd">.. autoconstant:: ENCODE_WEIGHTS</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">..util</span> <span class="k">import</span> <span class="n">io</span> <span class="k">as</span> <span class="n">_io</span>

<span class="kn">from</span> <span class="nn">._getters</span> <span class="k">import</span> <span class="n">EncodeType</span>
<span class="kn">from</span> <span class="nn">._symbol_table</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_float_weight</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_lattice_weight</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_lexicographic_weight</span>
<span class="kn">from</span> <span class="nn">._arc</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">._encode</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_compiler</span>
<span class="kn">from</span> <span class="nn">._fst</span> <span class="k">import</span> <span class="n">NO_STATE_ID</span><span class="p">,</span> <span class="n">NO_LABEL</span>
<span class="kn">from</span> <span class="nn">._fst</span> <span class="k">import</span> <span class="n">FstHeader</span><span class="p">,</span> <span class="n">FstReadOptions</span><span class="p">,</span> <span class="n">FstWriteOptions</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_fstext_shims</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_vector_fst</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_const_fst</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_drawer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_printer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_std_ops</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_log_ops</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_lat_ops</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_clat_ops</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">_index_ops</span>

<span class="kn">from</span> <span class="nn">._api</span> <span class="k">import</span> <span class="o">*</span>

<div class="viewcode-block" id="SymbolTableIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.SymbolTableIterator">[docs]</a><span class="k">class</span> <span class="nc">SymbolTableIterator</span><span class="p">(</span><span class="n">_symbol_table</span><span class="o">.</span><span class="n">SymbolTableIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Symbol table iterator.</span>

<span class="sd">    This class is used for iterating over the (index, symbol) pairs in a symbol</span>
<span class="sd">    table. In addition to the full C++ API, it also supports the iterator</span>
<span class="sd">    protocol, e.g. ::</span>

<span class="sd">        # Returns a symbol table containing only symbols referenced by fst.</span>
<span class="sd">        def prune_symbol_table(fst, syms, inp=True):</span>
<span class="sd">            seen = set([0])</span>
<span class="sd">            for s in fst.states():</span>
<span class="sd">                for a in fst.arcs(s):</span>
<span class="sd">                    seen.add(a.ilabel if inp else a.olabel)</span>
<span class="sd">            pruned = SymbolTable()</span>
<span class="sd">            for label, symbol in SymbolTableIterator(syms):</span>
<span class="sd">                if label in seen:</span>
<span class="sd">                    pruned.add_pair(symbol, label)</span>
<span class="sd">            return pruned</span>

<span class="sd">    Args:</span>
<span class="sd">        table: The symbol table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span></div>


<div class="viewcode-block" id="indices_to_symbols"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.indices_to_symbols">[docs]</a><span class="k">def</span> <span class="nf">indices_to_symbols</span><span class="p">(</span><span class="n">symbol_table</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts indices to symbols by looking them up in the symbol table.</span>

<span class="sd">    Args:</span>
<span class="sd">        symbol_table (SymbolTable): The symbol table.</span>
<span class="sd">        indices (List[int]): The list of indices.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The list of symbols corresponding to the given indices.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If an index is not found in the symbol table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol_table</span><span class="o">.</span><span class="n">find_symbol</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Index </span><span class="si">{}</span><span class="s2"> is not found in the symbol table.&quot;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">symbols</span></div>


<div class="viewcode-block" id="symbols_to_indices"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.symbols_to_indices">[docs]</a><span class="k">def</span> <span class="nf">symbols_to_indices</span><span class="p">(</span><span class="n">symbol_table</span><span class="p">,</span> <span class="n">symbols</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts symbols to indices by looking them up in the symbol table.</span>

<span class="sd">    Args:</span>
<span class="sd">        symbol_table (SymbolTable): The symbol table.</span>
<span class="sd">        indices (List[str]): The list of symbols.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[int]: The list of indices corresponding to the given symbols.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If a symbol is not found in the symbol table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">symbol_table</span><span class="o">.</span><span class="n">find_index</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Symbol </span><span class="si">{}</span><span class="s2"> is not found in the symbol table.&quot;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices</span></div>


<span class="c1"># Tropical semiring</span>

<div class="viewcode-block" id="TropicalWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.TropicalWeight">[docs]</a><span class="k">class</span> <span class="nc">TropicalWeight</span><span class="p">(</span><span class="n">_float_weight</span><span class="o">.</span><span class="n">TropicalWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tropical weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.TropicalWeight` instances.</span>

<span class="sd">    TropicalWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.TropicalWeight` instance.</span>

<span class="sd">    TropicalWeight(weight):</span>
<span class="sd">        Creates a new `~weight.TropicalWeight` instance initalized with the</span>
<span class="sd">        weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(float or FloatWeight): The weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">TropicalWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">FloatWeight</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">TropicalWeight</span><span class="o">.</span><span class="n">from_float</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">TropicalWeight</span><span class="o">.</span><span class="n">from_float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>


<div class="viewcode-block" id="StdArc"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdArc">[docs]</a><span class="k">class</span> <span class="nc">StdArc</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcBase</span><span class="p">,</span> <span class="n">_arc</span><span class="o">.</span><span class="n">StdArc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FST Arc with tropical weight.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdEncodeMapper"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdEncodeMapper">[docs]</a><span class="k">class</span> <span class="nc">StdEncodeMapper</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_EncodeMapper</span><span class="p">,</span> <span class="n">_encode</span><span class="o">.</span><span class="n">StdEncodeMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc encoder for an FST over the tropical semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdFstCompiler"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdFstCompiler">[docs]</a><span class="k">class</span> <span class="nc">StdFstCompiler</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstCompiler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiler for FSTs over the tropical semiring.&quot;&quot;&quot;</span>
    <span class="n">_compiler_type</span> <span class="o">=</span> <span class="n">_compiler</span><span class="o">.</span><span class="n">StdFstCompiler</span></div>


<span class="k">class</span> <span class="nc">_StdFstDrawer</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstDrawer</span><span class="p">,</span> <span class="n">_drawer</span><span class="o">.</span><span class="n">StdFstDrawer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawer for FSTs over the tropical semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_StdFstPrinter</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstPrinter</span><span class="p">,</span> <span class="n">_printer</span><span class="o">.</span><span class="n">StdFstPrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer for FSTs over the tropical semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="StdVectorFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdVectorFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">StdVectorFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                                <span class="n">_vector_fst</span><span class="o">.</span><span class="n">StdVectorFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a vector FST over the tropical semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdVectorFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdVectorFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">StdVectorFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                              <span class="n">_vector_fst</span><span class="o">.</span><span class="n">StdVectorFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a vector FST over the tropical semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdVectorFstMutableArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdVectorFstMutableArcIterator">[docs]</a><span class="k">class</span> <span class="nc">StdVectorFstMutableArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_MutableArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">StdVectorFstMutableArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mutable arc iterator for a vector FST over the tropical semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state and</span>
<span class="sd">    optionally replacing them with new ones. In addition to the full C++ API,</span>
<span class="sd">    it also supports the iterator protocol. Calling the `__iter__` method of a</span>
<span class="sd">    mutable arc iterator object returns an iterator over `(arc, setter)` pairs.</span>
<span class="sd">    The `setter` is a bound method of the mutable arc iterator object that can</span>
<span class="sd">    be used to replace the current arc with a new one. Most users should just</span>
<span class="sd">    call the `mutable_arcs` method of a vector FST object instead of directly</span>
<span class="sd">    constructing this iterator and take advantage of the Pythonic API, e.g. ::</span>

<span class="sd">        for arc, setter in fst.mutable_arcs(0):</span>
<span class="sd">            setter(StdArc(arc.ilabel, 0, arc.weight, arc.nextstate))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdVectorFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdVectorFst">[docs]</a><span class="k">class</span> <span class="nc">StdVectorFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_MutableFstBase</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">StdVectorFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector FST over the tropical semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_std_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_StdFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_StdFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">TropicalWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">StdVectorFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">StdVectorFstArcIterator</span>
    <span class="n">_mutable_arc_iterator_type</span> <span class="o">=</span> <span class="n">StdVectorFstMutableArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (StdFst): The input FST over the tropical semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StdVectorFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">StdVectorFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_std_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">StdFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_std_fst_to_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the tropical &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">StdVectorFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">StdVectorFst</span>


<div class="viewcode-block" id="StdConstFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdConstFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">StdConstFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                               <span class="n">_const_fst</span><span class="o">.</span><span class="n">StdConstFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a constant FST over the tropical semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdConstFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdConstFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">StdConstFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                             <span class="n">_const_fst</span><span class="o">.</span><span class="n">StdConstFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a constant FST over the tropical semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StdConstFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.StdConstFst">[docs]</a><span class="k">class</span> <span class="nc">StdConstFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstBase</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">StdConstFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant FST over the tropical semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_std_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_StdFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_StdFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">TropicalWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">StdConstFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">StdConstFstArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (StdFst): The input FST over the tropical semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StdConstFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">StdConstFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_std_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">StdFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_std_fst_to_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the tropical &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">StdConstFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">StdVectorFst</span>


<span class="c1"># Log semiring</span>

<div class="viewcode-block" id="LogWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogWeight">[docs]</a><span class="k">class</span> <span class="nc">LogWeight</span><span class="p">(</span><span class="n">_float_weight</span><span class="o">.</span><span class="n">LogWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.LogWeight` instances.</span>

<span class="sd">    LogWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.LogWeight` instance.</span>

<span class="sd">    LogWeight(weight):</span>
<span class="sd">        Creates a new `~weight.LogWeight` instance initalized with the weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(float or FloatWeight): The weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">LogWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">FloatWeight</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">LogWeight</span><span class="o">.</span><span class="n">from_float</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_float_weight</span><span class="o">.</span><span class="n">LogWeight</span><span class="o">.</span><span class="n">from_float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span></div>


<div class="viewcode-block" id="LogArc"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogArc">[docs]</a><span class="k">class</span> <span class="nc">LogArc</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcBase</span><span class="p">,</span> <span class="n">_arc</span><span class="o">.</span><span class="n">LogArc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FST Arc with log weight.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogEncodeMapper"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogEncodeMapper">[docs]</a><span class="k">class</span> <span class="nc">LogEncodeMapper</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_EncodeMapper</span><span class="p">,</span> <span class="n">_encode</span><span class="o">.</span><span class="n">LogEncodeMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc encoder for an FST over the log semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogFstCompiler"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogFstCompiler">[docs]</a><span class="k">class</span> <span class="nc">LogFstCompiler</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstCompiler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiler for FSTs over the log semiring.&quot;&quot;&quot;</span>
    <span class="n">_compiler_type</span> <span class="o">=</span> <span class="n">_compiler</span><span class="o">.</span><span class="n">LogFstCompiler</span></div>


<span class="k">class</span> <span class="nc">_LogFstDrawer</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstDrawer</span><span class="p">,</span> <span class="n">_drawer</span><span class="o">.</span><span class="n">LogFstDrawer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawer for FSTs over the log semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_LogFstPrinter</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstPrinter</span><span class="p">,</span> <span class="n">_printer</span><span class="o">.</span><span class="n">LogFstPrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer for FSTs over the log semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="LogVectorFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogVectorFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">LogVectorFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                                <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LogVectorFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a vector FST over the log semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogVectorFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogVectorFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LogVectorFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                              <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LogVectorFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a vector FST over the log semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogVectorFstMutableArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogVectorFstMutableArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LogVectorFstMutableArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_MutableArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LogVectorFstMutableArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mutable arc iterator for a vector FST over the log semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state and</span>
<span class="sd">    optionally replacing them with new ones. In addition to the full C++ API,</span>
<span class="sd">    it also supports the iterator protocol. Calling the `__iter__` method of a</span>
<span class="sd">    mutable arc iterator object returns an iterator over `(arc, setter)` pairs.</span>
<span class="sd">    The `setter` is a bound method of the mutable arc iterator object that can</span>
<span class="sd">    be used to replace the current arc with a new one. Most users should just</span>
<span class="sd">    call the `mutable_arcs` method of a vector FST object instead of directly</span>
<span class="sd">    constructing this iterator and take advantage of the Pythonic API, e.g. ::</span>

<span class="sd">        for arc, setter in logfst.mutable_arcs(0):</span>
<span class="sd">            setter(LogArc(arc.ilabel, 0, arc.weight, arc.nextstate))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogVectorFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogVectorFst">[docs]</a><span class="k">class</span> <span class="nc">LogVectorFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_MutableFstBase</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LogVectorFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector FST over the log semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_log_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_LogFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_LogFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">LogWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">LogVectorFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">LogVectorFstArcIterator</span>
    <span class="n">_mutable_arc_iterator_type</span> <span class="o">=</span> <span class="n">LogVectorFstMutableArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (LogFst): The input FST over the log semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LogVectorFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LogVectorFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_log_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">LogFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_log_fst_to_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the log semiring&quot;</span><span class="p">)</span></div>

<span class="n">LogVectorFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">LogVectorFst</span>


<div class="viewcode-block" id="LogConstFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogConstFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">LogConstFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                               <span class="n">_const_fst</span><span class="o">.</span><span class="n">LogConstFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a constant FST over the log semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogConstFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogConstFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LogConstFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                             <span class="n">_const_fst</span><span class="o">.</span><span class="n">LogConstFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a constant FST over the log semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LogConstFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LogConstFst">[docs]</a><span class="k">class</span> <span class="nc">LogConstFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstBase</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">LogConstFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant FST over the log semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_log_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_LogFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_LogFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">LogWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">LogConstFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">LogConstFstArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (LogFst): The input FST over the log semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LogConstFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">LogConstFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_log_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">LogFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_log_fst_to_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the log semiring&quot;</span><span class="p">)</span></div>

<span class="n">LogConstFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">LogVectorFst</span>


<span class="c1"># Lattice semiring</span>

<div class="viewcode-block" id="LatticeWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeWeight">[docs]</a><span class="k">class</span> <span class="nc">LatticeWeight</span><span class="p">(</span><span class="n">_lattice_weight</span><span class="o">.</span><span class="n">LatticeWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lattice weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.LatticeWeight` instances.</span>

<span class="sd">    LatticeWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.LatticeWeight` instance.</span>

<span class="sd">    LatticeWeight(weight):</span>
<span class="sd">        Creates a new `~weight.LatticeWeight` instance initalized with the</span>
<span class="sd">        weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(Tuple[float, float] or LatticeWeight): A pair of weight values</span>
<span class="sd">        or another `~weight.LatticeWeight` instance.</span>

<span class="sd">    LatticeWeight(weight1, weight2):</span>
<span class="sd">        Creates a new `~weight.LatticeWeight` instance initalized with the</span>
<span class="sd">        weights.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight1(float): The first weight value.</span>
<span class="sd">        weight2(float): The second weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">LatticeWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">LatticeWeight</span><span class="o">.</span><span class="n">from_other</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">LatticeWeight</span><span class="o">.</span><span class="n">from_pair</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="LatticeArc"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeArc">[docs]</a><span class="k">class</span> <span class="nc">LatticeArc</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcBase</span><span class="p">,</span> <span class="n">_arc</span><span class="o">.</span><span class="n">LatticeArc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FST Arc with lattice weight.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeEncodeMapper"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeEncodeMapper">[docs]</a><span class="k">class</span> <span class="nc">LatticeEncodeMapper</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_EncodeMapper</span><span class="p">,</span> <span class="n">_encode</span><span class="o">.</span><span class="n">LatticeEncodeMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc encoder for an FST over the lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeFstCompiler"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeFstCompiler">[docs]</a><span class="k">class</span> <span class="nc">LatticeFstCompiler</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstCompiler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiler for FSTs over the lattice semiring.&quot;&quot;&quot;</span>
    <span class="n">_compiler_type</span> <span class="o">=</span> <span class="n">_compiler</span><span class="o">.</span><span class="n">LatticeFstCompiler</span></div>


<span class="k">class</span> <span class="nc">_LatticeFstDrawer</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstDrawer</span><span class="p">,</span> <span class="n">_drawer</span><span class="o">.</span><span class="n">LatticeFstDrawer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawer for FSTs over the lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_LatticeFstPrinter</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstPrinter</span><span class="p">,</span> <span class="n">_printer</span><span class="o">.</span><span class="n">LatticeFstPrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer for FSTs over the lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="LatticeVectorFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeVectorFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">LatticeVectorFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                                    <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LatticeVectorFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a vector FST over the lattice semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeVectorFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeVectorFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LatticeVectorFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                                  <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LatticeVectorFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a vector FST over the lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeVectorFstMutableArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeVectorFstMutableArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LatticeVectorFstMutableArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_MutableArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LatticeVectorFstMutableArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mutable arc iterator for a vector FST over the lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state and</span>
<span class="sd">    optionally replacing them with new ones. In addition to the full C++ API,</span>
<span class="sd">    it also supports the iterator protocol. Calling the `__iter__` method of a</span>
<span class="sd">    mutable arc iterator object returns an iterator over `(arc, setter)` pairs.</span>
<span class="sd">    The `setter` is a bound method of the mutable arc iterator object that can</span>
<span class="sd">    be used to replace the current arc with a new one. Most users should just</span>
<span class="sd">    call the `mutable_arcs` method of a vector FST object instead of directly</span>
<span class="sd">    constructing this iterator and take advantage of the Pythonic API, e.g. ::</span>

<span class="sd">        for arc, setter in lattice.mutable_arcs(0):</span>
<span class="sd">            setter(LatticeArc(arc.ilabel, 0, arc.weight, arc.nextstate))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeVectorFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeVectorFst">[docs]</a><span class="k">class</span> <span class="nc">LatticeVectorFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_MutableFstBase</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LatticeVectorFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector FST over the lattice semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_lat_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_LatticeFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_LatticeFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">LatticeWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">LatticeVectorFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">LatticeVectorFstArcIterator</span>
    <span class="n">_mutable_arc_iterator_type</span> <span class="o">=</span> <span class="n">LatticeVectorFstMutableArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (LatticeFst): The input FST over the lattice semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LatticeVectorFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">LatticeVectorFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_lattice_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">LatticeFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_lattice_fst_to_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the lattice &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">LatticeVectorFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">LatticeVectorFst</span>


<div class="viewcode-block" id="LatticeConstFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeConstFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">LatticeConstFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                                   <span class="n">_const_fst</span><span class="o">.</span><span class="n">LatticeConstFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a constant FST over the lattice semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeConstFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeConstFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">LatticeConstFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                                 <span class="n">_const_fst</span><span class="o">.</span><span class="n">LatticeConstFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a constant FST over the lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LatticeConstFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.LatticeConstFst">[docs]</a><span class="k">class</span> <span class="nc">LatticeConstFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstBase</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">LatticeConstFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant FST over the lattice semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_lat_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_LatticeFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_LatticeFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">LatticeWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">LatticeConstFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">LatticeConstFstArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (LatticeFst): The input FST over the lattice semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LatticeConstFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">LatticeConstFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_lattice_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">LatticeFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_lattice_fst_to_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the lattice &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">LatticeConstFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">LatticeVectorFst</span>


<span class="c1"># CompactLattice semiring</span>

<div class="viewcode-block" id="CompactLatticeWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeWeight">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeWeight</span><span class="p">(</span><span class="n">_lattice_weight</span><span class="o">.</span><span class="n">CompactLatticeWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compact lattice weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.CompactLatticeWeight`</span>
<span class="sd">    instances.</span>

<span class="sd">    CompactLatticeWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.CompactLatticeWeight` instance.</span>

<span class="sd">    CompactLatticeWeight(weight):</span>
<span class="sd">        Creates a new `~weight.CompactLatticeWeight` instance initalized with</span>
<span class="sd">        the weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(Tuple[Tuple[float, float], List[int]] or Tuple[LatticeWeight, List[int]] or CompactLatticeWeight):</span>
<span class="sd">            A pair of weight values or another `~weight.CompactLatticeWeight`</span>
<span class="sd">            instance.</span>

<span class="sd">    CompactLatticeWeight(weight, string):</span>
<span class="sd">        Creates a new `~weight.CompactLatticeWeight` instance initalized with</span>
<span class="sd">        the (weight, string) pair.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(Tuple[float, float] or LatticeWeight): The weight value.</span>
<span class="sd">        string(List[int]): The string value given as a list of integers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">CompactLatticeWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">CompactLatticeWeight</span><span class="o">.</span><span class="n">from_other</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">LatticeWeight</span><span class="p">):</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">LatticeWeight</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_lattice_weight</span><span class="o">.</span><span class="n">CompactLatticeWeight</span><span class="o">.</span><span class="n">from_pair</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;CompactLatticeWeight accepts 0 to 2 &quot;</span>
                        <span class="s2">&quot;positional arguments; </span><span class="si">{}</span><span class="s2"> given&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span></div>


<div class="viewcode-block" id="CompactLatticeArc"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeArc">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeArc</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcBase</span><span class="p">,</span> <span class="n">_arc</span><span class="o">.</span><span class="n">CompactLatticeArc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FST Arc with compact lattice weight.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeEncodeMapper"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeEncodeMapper">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeEncodeMapper</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_EncodeMapper</span><span class="p">,</span>
                                 <span class="n">_encode</span><span class="o">.</span><span class="n">CompactLatticeEncodeMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc encoder for an FST over the compact lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeFstCompiler"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeFstCompiler">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeFstCompiler</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstCompiler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiler for FSTs over the compact lattice semiring.&quot;&quot;&quot;</span>
    <span class="n">_compiler_type</span> <span class="o">=</span> <span class="n">_compiler</span><span class="o">.</span><span class="n">CompactLatticeFstCompiler</span></div>


<span class="k">class</span> <span class="nc">_CompactLatticeFstDrawer</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstDrawer</span><span class="p">,</span> <span class="n">_drawer</span><span class="o">.</span><span class="n">CompactLatticeFstDrawer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawer for FSTs over the compact lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_CompactLatticeFstPrinter</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstPrinter</span><span class="p">,</span> <span class="n">_printer</span><span class="o">.</span><span class="n">CompactLatticeFstPrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer for FSTs over the compact lattice semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="CompactLatticeVectorFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeVectorFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeVectorFstStateIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">CompactLatticeVectorFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a vector FST over the compact lattice semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeVectorFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeVectorFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeVectorFstArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">CompactLatticeVectorFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a vector FST over the compact lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeVectorFstMutableArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeVectorFstMutableArcIterator">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeVectorFstMutableArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_MutableArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">CompactLatticeVectorFstMutableArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mutable arc iterator for a vector FST over the compact lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state and</span>
<span class="sd">    optionally replacing them with new ones. In addition to the full C++ API,</span>
<span class="sd">    it also supports the iterator protocol. Calling the `__iter__` method of a</span>
<span class="sd">    mutable arc iterator object returns an iterator over `(arc, setter)` pairs.</span>
<span class="sd">    The `setter` is a bound method of the mutable arc iterator object that can</span>
<span class="sd">    be used to replace the current arc with a new one. Most users should just</span>
<span class="sd">    call the `mutable_arcs` method of a vector FST object instead of directly</span>
<span class="sd">    constructing this iterator and take advantage of the Pythonic API, e.g. ::</span>

<span class="sd">        for arc, setter in lattice.mutable_arcs(0):</span>
<span class="sd">            setter(LatticeArc(arc.ilabel, 0, arc.weight, arc.nextstate))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeVectorFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeVectorFst">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeVectorFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_MutableFstBase</span><span class="p">,</span>
                        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">CompactLatticeVectorFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector FST over the compact lattice semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_clat_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_CompactLatticeFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_CompactLatticeFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">CompactLatticeWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFstArcIterator</span>
    <span class="n">_mutable_arc_iterator_type</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFstMutableArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (CompactLatticeFst): The input FST over the compact lattice</span>
<span class="sd">                semiring. If provided, its contents are used for initializing</span>
<span class="sd">                the new FST. Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompactLatticeVectorFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">CompactLatticeVectorFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_compact_lattice_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">CompactLatticeFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_compact_lattice_fst_to_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the compact lattice &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">CompactLatticeVectorFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFst</span>


<div class="viewcode-block" id="CompactLatticeConstFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeConstFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeConstFstStateIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
        <span class="n">_const_fst</span><span class="o">.</span><span class="n">CompactLatticeConstFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a constant FST over the compact lattice semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeConstFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeConstFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeConstFstArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
        <span class="n">_const_fst</span><span class="o">.</span><span class="n">CompactLatticeConstFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a constant FST over the compact lattice semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="CompactLatticeConstFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.CompactLatticeConstFst">[docs]</a><span class="k">class</span> <span class="nc">CompactLatticeConstFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstBase</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">CompactLatticeConstFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant FST over the compact lattice semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_clat_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_CompactLatticeFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_CompactLatticeFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">CompactLatticeWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">CompactLatticeConstFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">CompactLatticeConstFstArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (CompactLatticeFst): The input FST over the compact lattice</span>
<span class="sd">                semiring. If provided, its contents are used for initializing</span>
<span class="sd">                the new FST. Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompactLatticeConstFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">CompactLatticeConstFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_compact_lattice_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">CompactLatticeFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_compact_lattice_fst_to_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span>
                                                                       <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the compact lattice &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">CompactLatticeConstFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFst</span>


<span class="c1"># KWS index semiring</span>

<div class="viewcode-block" id="KwsTimeWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsTimeWeight">[docs]</a><span class="k">class</span> <span class="nc">KwsTimeWeight</span><span class="p">(</span><span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsTimeWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;KWS time weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.KwsTimeWeight` instances.</span>

<span class="sd">    KwsTimeWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.KwsTimeWeight` instance.</span>

<span class="sd">    KwsTimeWeight(weight):</span>
<span class="sd">        Creates a new `~weight.KwsTimeWeight` instance initalized with the</span>
<span class="sd">        weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(Tuple[float, float] or KwsTimeWeight): A pair of weight values</span>
<span class="sd">        or another `~weight.KwsTimeWeight` instance.</span>

<span class="sd">    KwsTimeWeight(weight1, weight2):</span>
<span class="sd">        Creates a new `~weight.KwsTimeWeight` instance initalized with the</span>
<span class="sd">        weights.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight1(float): The first weight value.</span>
<span class="sd">        weight2(float): The second weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsTimeWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value1</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value2</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">TropicalWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">TropicalWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsTimeWeight</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="KwsIndexWeight"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexWeight">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexWeight</span><span class="p">(</span><span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsIndexWeight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;KWS index weight factory.</span>

<span class="sd">    This class is used for creating new `~weight.KwsIndexWeight`</span>
<span class="sd">    instances.</span>

<span class="sd">    KwsIndexWeight():</span>
<span class="sd">        Creates an uninitialized `~weight.KwsIndexWeight` instance.</span>

<span class="sd">    KwsIndexWeight(weight):</span>
<span class="sd">        Creates a new `~weight.KwsIndexWeight` instance initalized with</span>
<span class="sd">        the weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight(Tuple[float, Tuple[float, float]] or Tuple[TropicalWeight, KwsTimeWeight] or KwsIndexWeight):</span>
<span class="sd">            A pair of weight values or another `~weight.KwsIndexWeight`</span>
<span class="sd">            instance.</span>

<span class="sd">    KwsIndexWeight(weight1, weight2):</span>
<span class="sd">        Creates a new `~weight.KwsIndexWeight` instance initalized with</span>
<span class="sd">        weights.</span>

<span class="sd">    Args:</span>
<span class="sd">        weight1(float or TropicalWeight): The first weight value.</span>
<span class="sd">        weight2(Tuple[float, float] or KwsTimeWeight): The second weight value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsIndexWeight</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">TropicalWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">KwsTimeWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value1</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsIndexWeight</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">TropicalWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">KwsTimeWeight</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">_lexicographic_weight</span><span class="o">.</span><span class="n">KwsIndexWeight</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;KwsIndexWeight accepts 0 to 2 &quot;</span>
                        <span class="s2">&quot;positional arguments; </span><span class="si">{}</span><span class="s2"> given&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span></div>


<div class="viewcode-block" id="KwsIndexArc"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexArc">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexArc</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcBase</span><span class="p">,</span> <span class="n">_arc</span><span class="o">.</span><span class="n">KwsIndexArc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FST Arc with KWS index weight.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexEncodeMapper"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexEncodeMapper">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexEncodeMapper</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_EncodeMapper</span><span class="p">,</span> <span class="n">_encode</span><span class="o">.</span><span class="n">KwsIndexEncodeMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc encoder for an FST over the KWS index semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexFstCompiler"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexFstCompiler">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexFstCompiler</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstCompiler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiler for FSTs over the KWS index semiring.&quot;&quot;&quot;</span>
    <span class="n">_compiler_type</span> <span class="o">=</span> <span class="n">_compiler</span><span class="o">.</span><span class="n">KwsIndexFstCompiler</span></div>


<span class="k">class</span> <span class="nc">_KwsIndexFstDrawer</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstDrawer</span><span class="p">,</span> <span class="n">_drawer</span><span class="o">.</span><span class="n">KwsIndexFstDrawer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawer for FSTs over the KWS index semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_KwsIndexFstPrinter</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstPrinter</span><span class="p">,</span> <span class="n">_printer</span><span class="o">.</span><span class="n">KwsIndexFstPrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Printer for FSTs over the KWS index semiring.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="KwsIndexVectorFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexVectorFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexVectorFstStateIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">KwsIndexVectorFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a vector FST over the KWS index semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexVectorFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexVectorFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexVectorFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                                   <span class="n">_vector_fst</span><span class="o">.</span><span class="n">KwsIndexVectorFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a vector FST over the KWS index semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexVectorFstMutableArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexVectorFstMutableArcIterator">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexVectorFstMutableArcIterator</span><span class="p">(</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">_MutableArcIteratorBase</span><span class="p">,</span>
        <span class="n">_vector_fst</span><span class="o">.</span><span class="n">KwsIndexVectorFstMutableArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mutable arc iterator for a vector FST over the KWS index semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state and</span>
<span class="sd">    optionally replacing them with new ones. In addition to the full C++ API,</span>
<span class="sd">    it also supports the iterator protocol. Calling the `__iter__` method of a</span>
<span class="sd">    mutable arc iterator object returns an iterator over `(arc, setter)` pairs.</span>
<span class="sd">    The `setter` is a bound method of the mutable arc iterator object that can</span>
<span class="sd">    be used to replace the current arc with a new one. Most users should just</span>
<span class="sd">    call the `mutable_arcs` method of a vector FST object instead of directly</span>
<span class="sd">    constructing this iterator and take advantage of the Pythonic API, e.g. ::</span>

<span class="sd">        for arc, setter in fst.mutable_arcs(0):</span>
<span class="sd">            setter(KwsIndexArc(arc.ilabel, 0, arc.weight, arc.nextstate))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexVectorFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexVectorFst">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexVectorFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_MutableFstBase</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">KwsIndexVectorFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Vector FST over the KWS index semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_index_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_KwsIndexFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_KwsIndexFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">KwsIndexWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">KwsIndexVectorFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">KwsIndexVectorFstArcIterator</span>
    <span class="n">_mutable_arc_iterator_type</span> <span class="o">=</span> <span class="n">KwsIndexVectorFstMutableArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (KwsIndexFst): The input FST over the KWS index semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KwsIndexVectorFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_vector_fst</span><span class="o">.</span><span class="n">KwsIndexVectorFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_kws_index_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">KwsIndexFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_kws_index_fst_to_vector_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the KWS index &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">KwsIndexVectorFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">KwsIndexVectorFst</span>


<div class="viewcode-block" id="KwsIndexConstFstStateIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexConstFstStateIterator">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexConstFstStateIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_StateIteratorBase</span><span class="p">,</span>
                                    <span class="n">_const_fst</span><span class="o">.</span><span class="n">KwsIndexConstFstStateIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;State iterator for a constant FST over the KWS index semiring.</span>

<span class="sd">    This class is used for iterating over the states. In addition to the full</span>
<span class="sd">    C++ API, it also supports the iterator protocol. Most users should just call</span>
<span class="sd">    the `states` method of an FST object instead of directly constructing this</span>
<span class="sd">    iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexConstFstArcIterator"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexConstFstArcIterator">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexConstFstArcIterator</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_ArcIteratorBase</span><span class="p">,</span>
                                  <span class="n">_const_fst</span><span class="o">.</span><span class="n">KwsIndexConstFstArcIterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Arc iterator for a constant FST over the KWS index semiring.</span>

<span class="sd">    This class is used for iterating over the arcs leaving some state. In</span>
<span class="sd">    addition to the full C++ API, it also supports the iterator protocol.</span>
<span class="sd">    Most users should just call the `arcs` method of an FST object instead of</span>
<span class="sd">    directly constructing this iterator and take advantage of the Pythonic API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="KwsIndexConstFst"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.KwsIndexConstFst">[docs]</a><span class="k">class</span> <span class="nc">KwsIndexConstFst</span><span class="p">(</span><span class="n">_api</span><span class="o">.</span><span class="n">_FstBase</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">KwsIndexConstFst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constant FST over the KWS index semiring.&quot;&quot;&quot;</span>

    <span class="n">_ops</span> <span class="o">=</span> <span class="n">_index_ops</span>
    <span class="n">_drawer_type</span> <span class="o">=</span> <span class="n">_KwsIndexFstDrawer</span>
    <span class="n">_printer_type</span> <span class="o">=</span> <span class="n">_KwsIndexFstPrinter</span>
    <span class="n">_weight_factory</span> <span class="o">=</span> <span class="n">KwsIndexWeight</span>
    <span class="n">_state_iterator_type</span> <span class="o">=</span> <span class="n">KwsIndexConstFstStateIterator</span>
    <span class="n">_arc_iterator_type</span> <span class="o">=</span> <span class="n">KwsIndexConstFstArcIterator</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            fst (KwsIndexFst): The input FST over the KWS index semiring.</span>
<span class="sd">                If provided, its contents are used for initializing the new FST.</span>
<span class="sd">                Defaults to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KwsIndexConstFst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_const_fst</span><span class="o">.</span><span class="n">KwsIndexConstFst</span><span class="p">):</span>
                <span class="c1"># This assignment shares implementation with COW semantics.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_kws_index_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">_fst</span><span class="o">.</span><span class="n">KwsIndexFst</span><span class="p">):</span>
                <span class="c1"># This assignment makes a copy.</span>
                <span class="n">_fstext_shims</span><span class="o">.</span><span class="n">_assign_kws_index_fst_to_const_fst</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;fst should be an FST over the KWS index &quot;</span>
                                <span class="s2">&quot;semiring&quot;</span><span class="p">)</span></div>

<span class="n">KwsIndexConstFst</span><span class="o">.</span><span class="n">_mutable_fst_type</span> <span class="o">=</span> <span class="n">KwsIndexVectorFst</span>


<span class="c1"># Kaldi I/O</span>

<div class="viewcode-block" id="read_fst_kaldi"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.read_fst_kaldi">[docs]</a><span class="k">def</span> <span class="nf">read_fst_kaldi</span><span class="p">(</span><span class="n">rxfilename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads FST using Kaldi I/O mechanisms.</span>

<span class="sd">    Does not support reading in text mode.</span>

<span class="sd">    Args:</span>
<span class="sd">        rxfilename (str): Extended filename for reading the FST.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An FST object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        IOError: If reading fails.</span>
<span class="sd">        TypeError: If FST type or arc type is not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">_io</span><span class="o">.</span><span class="n">xopen</span><span class="p">(</span><span class="n">rxfilename</span><span class="p">)</span> <span class="k">as</span> <span class="n">ki</span><span class="p">:</span>
        <span class="n">rxfilename</span> <span class="o">=</span> <span class="n">_io</span><span class="o">.</span><span class="n">printable_rxfilename</span><span class="p">(</span><span class="n">rxfilename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ki</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span><span class="o">.</span><span class="n">good</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Could not open </span><span class="si">{}</span><span class="s2"> for reading.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rxfilename</span><span class="p">))</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">FstHeader</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hdr</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ki</span><span class="o">.</span><span class="n">stream</span><span class="p">(),</span> <span class="n">rxfilename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Error reading FST header.&quot;</span><span class="p">)</span>
        <span class="n">fst_type</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">fst_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fst_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="s2">&quot;const&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unsupported FST type: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fst_type</span><span class="p">))</span>
        <span class="n">arc_type</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">arc_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arc_type</span> <span class="o">==</span> <span class="n">StdArc</span><span class="o">.</span><span class="n">type</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">StdVectorFst</span>
            <span class="k">elif</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">StdConstFst</span>
        <span class="k">elif</span> <span class="n">arc_type</span> <span class="o">==</span> <span class="n">LogArc</span><span class="o">.</span><span class="n">type</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">LogVectorFst</span>
            <span class="k">elif</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">LogConstFst</span>
        <span class="k">elif</span> <span class="n">arc_type</span> <span class="o">==</span> <span class="n">LatticeArc</span><span class="o">.</span><span class="n">type</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">LatticeVectorFst</span>
            <span class="k">elif</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">LatticeConstFst</span>
        <span class="k">elif</span> <span class="n">arc_type</span> <span class="o">==</span> <span class="n">CompactLatticeArc</span><span class="o">.</span><span class="n">type</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">CompactLatticeVectorFst</span>
            <span class="k">elif</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">CompactLatticeConstFst</span>
        <span class="k">elif</span> <span class="n">arc_type</span> <span class="o">==</span> <span class="n">KwsIndexArc</span><span class="o">.</span><span class="n">type</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">KwsIndexVectorFst</span>
            <span class="k">elif</span> <span class="n">fst_type</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">fst_class</span> <span class="o">=</span> <span class="n">KwsIndexConstFst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unsupported FST arc type: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arc_type</span><span class="p">))</span>
        <span class="n">ropts</span> <span class="o">=</span> <span class="n">FstReadOptions</span><span class="p">(</span><span class="n">rxfilename</span><span class="p">,</span> <span class="n">hdr</span><span class="p">)</span>
        <span class="n">fst</span> <span class="o">=</span> <span class="n">fst_class</span><span class="o">.</span><span class="n">read_from_stream</span><span class="p">(</span><span class="n">ki</span><span class="o">.</span><span class="n">stream</span><span class="p">(),</span> <span class="n">ropts</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fst</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Error reading FST (after reading header).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fst</span></div>


<div class="viewcode-block" id="write_fst_kaldi"><a class="viewcode-back" href="../../api/kaldi.fstext.html#kaldi.fstext.write_fst_kaldi">[docs]</a><span class="k">def</span> <span class="nf">write_fst_kaldi</span><span class="p">(</span><span class="n">fst</span><span class="p">,</span> <span class="n">wxfilename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes FST using Kaldi I/O mechanisms.</span>

<span class="sd">    FST is written in binary mode without Kaldi binary mode header.</span>

<span class="sd">    Args:</span>
<span class="sd">        fst: The FST to write.</span>
<span class="sd">        wxfilename (str): Extended filename for writing the FST.</span>

<span class="sd">    Raises:</span>
<span class="sd">        IOError: If writing fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">_io</span><span class="o">.</span><span class="n">xopen</span><span class="p">(</span><span class="n">wxfilename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">ko</span><span class="p">:</span>
        <span class="n">wxfilename</span> <span class="o">=</span> <span class="n">_io</span><span class="o">.</span><span class="n">printable_wxfilename</span><span class="p">(</span><span class="n">wxfilename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ko</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span><span class="o">.</span><span class="n">good</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Could not open </span><span class="si">{}</span><span class="s2"> for writing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wxfilename</span><span class="p">))</span>
        <span class="n">wopts</span> <span class="o">=</span> <span class="n">FstWriteOptions</span><span class="p">(</span><span class="n">wxfilename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fst</span><span class="o">.</span><span class="n">write_to_stream</span><span class="p">(</span><span class="n">ko</span><span class="o">.</span><span class="n">stream</span><span class="p">(),</span> <span class="n">wopts</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Error writing FST.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span></div>


<span class="c1">################################################################################</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">()</span>
           <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span>
           <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Base&#39;</span><span class="p">)]</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Doan Can, Victor Martinez.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.0.9',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>